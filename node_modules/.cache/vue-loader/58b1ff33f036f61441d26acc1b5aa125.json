{"remainingRequest":"/Volumes/MAC1/javaproject/Sober-web1/node_modules/vue-loader/lib/index.js??vue-loader-options!/Volumes/MAC1/javaproject/Sober-web1/src/views/tools/aliPay/toPay.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Volumes/MAC1/javaproject/Sober-web1/src/views/tools/aliPay/toPay.vue","mtime":1619011782556},{"path":"/Volumes/MAC1/javaproject/Sober-web1/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/MAC1/javaproject/Sober-web1/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Volumes/MAC1/javaproject/Sober-web1/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/MAC1/javaproject/Sober-web1/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { toAliPay } from '@/api/tools/alipay'\nexport default {\n  data() {\n    return {\n      url: '',\n      // 新窗口的引用\n      newWin: null,\n      loading: false, form: { subject: '', totalAmount: '', body: '' },\n      rules: {\n        subject: [\n          { required: true, message: '商品名称不能为空', trigger: 'blur' }\n        ],\n        totalAmount: [\n          { required: true, message: '商品价格不能为空', trigger: 'blur' }\n        ],\n        body: [\n          { required: true, message: '商品描述不能为空', trigger: 'blur' }\n        ]\n      }\n    }\n  },\n  watch: {\n    url(newVal, oldVal) {\n      if (newVal && this.newWin) {\n        this.newWin.sessionStorage.clear()\n        this.newWin.location.href = newVal\n        // 重定向后把url和newWin重置\n        this.url = ''\n        this.newWin = null\n      }\n    }\n  },\n  methods: {\n    doSubmit() {\n      this.$refs['form'].validate((valid) => {\n        if (valid) {\n          this.loading = true\n          // 先打开一个空的新窗口，再请求\n          this.newWin = window.open()\n          let url = ''\n          if (/(Android)/i.test(navigator.userAgent)) { // 判断是否为Android手机\n            url = 'aliPay/toPayAsWeb'\n          } else if (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) { // 判断是否为苹果手机\n            url = 'aliPay/toPayAsWeb'\n          } else {\n            url = 'aliPay/toPayAsPC'\n          }\n          toAliPay(url, this.form).then(res => {\n            this.loading = false\n            this.url = res\n          }).catch(err => {\n            this.loading = false\n            console.log(err.response.data.message)\n          })\n        } else {\n          return false\n        }\n      })\n    }\n  }\n}\n",null]}