{"remainingRequest":"/Volumes/MAC1/javaproject/eladmin-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Volumes/MAC1/javaproject/eladmin-web/src/views/tools/email/send.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Volumes/MAC1/javaproject/eladmin-web/src/views/tools/email/send.vue","mtime":1619011782556},{"path":"/Volumes/MAC1/javaproject/eladmin-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/MAC1/javaproject/eladmin-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Volumes/MAC1/javaproject/eladmin-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/MAC1/javaproject/eladmin-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { send } from '@/api/tools/email'\nimport { upload } from '@/utils/upload'\nimport { validEmail } from '@/utils/validate'\nimport { mapGetters } from 'vuex'\nimport E from 'wangeditor'\nexport default {\n  name: 'Index',\n  data() {\n    return {\n      loading: false, form: { subject: '', tos: [], content: '' },\n      tos: [{\n        value: ''\n      }],\n      rules: {\n        subject: [\n          { required: true, message: '标题不能为空', trigger: 'blur' }\n        ]\n      }\n    }\n  },\n  computed: {\n    ...mapGetters([\n      'imagesUploadApi'\n    ])\n  },\n  mounted() {\n    const _this = this\n    var editor = new E(this.$refs.editor)\n    // 自定义菜单配置\n    editor.customConfig.zIndex = 10\n    // 文件上传\n    editor.customConfig.customUploadImg = function(files, insert) {\n      // files 是 input 中选中的文件列表\n      // insert 是获取图片 url 后，插入到编辑器的方法\n      files.forEach(image => {\n        files.forEach(image => {\n          upload(_this.imagesUploadApi, image).then(data => {\n            insert(data.data.url)\n          })\n        })\n      })\n    }\n    editor.customConfig.onchange = (html) => {\n      this.form.content = html\n    }\n    editor.create()\n  },\n  methods: {\n    removeDomain(item) {\n      var index = this.tos.indexOf(item)\n      if (index !== -1 && this.tos.length !== 1) {\n        this.tos.splice(index, 1)\n      } else {\n        this.$message({\n          message: '请至少保留一位联系人',\n          type: 'warning'\n        })\n      }\n    },\n    addDomain() {\n      this.tos.push({\n        value: '',\n        key: Date.now()\n      })\n    },\n    doSubmit() {\n      const _this = this\n      this.$refs['form'].validate((valid) => {\n        this.form.tos = []\n        if (valid) {\n          let sub = false\n          this.tos.forEach(function(data, index) {\n            if (data.value === '') {\n              _this.$message({\n                message: '收件邮箱不能为空',\n                type: 'warning'\n              })\n              sub = true\n            } else if (validEmail(data.value)) {\n              _this.form.tos.push(data.value)\n            } else {\n              _this.$message({\n                message: '收件邮箱格式错误',\n                type: 'warning'\n              })\n              sub = true\n            }\n          })\n          if (sub) { return false }\n          this.loading = true\n          send(this.form).then(res => {\n            this.$notify({\n              title: '发送成功',\n              type: 'success',\n              duration: 2500\n            })\n            this.loading = false\n          }).catch(err => {\n            this.loading = false\n            console.log(err.response.data.message)\n          })\n        } else {\n          return false\n        }\n      })\n    }\n  }\n}\n",null]}