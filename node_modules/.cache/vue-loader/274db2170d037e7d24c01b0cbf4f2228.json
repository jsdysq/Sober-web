{"remainingRequest":"/Volumes/MAC1/javaproject/Sober-web1/node_modules/vue-loader/lib/index.js??vue-loader-options!/Volumes/MAC1/javaproject/Sober-web1/src/views/login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Volumes/MAC1/javaproject/Sober-web1/src/views/login.vue","mtime":1619011782546},{"path":"/Volumes/MAC1/javaproject/Sober-web1/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/MAC1/javaproject/Sober-web1/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Volumes/MAC1/javaproject/Sober-web1/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/MAC1/javaproject/Sober-web1/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { encrypt } from '@/utils/rsaEncrypt'\nimport Config from '@/settings'\nimport { getCodeImg } from '@/api/login'\nimport Cookies from 'js-cookie'\nimport qs from 'qs'\nimport Background from '@/assets/images/background.jpg'\nexport default {\n  name: 'Login',\n  data() {\n    return {\n      Background: Background,\n      codeUrl: '',\n      cookiePass: '',\n      loginForm: {\n        username: 'admin',\n        password: '123456',\n        rememberMe: false,\n        code: '',\n        uuid: ''\n      },\n      loginRules: {\n        username: [{ required: true, trigger: 'blur', message: '用户名不能为空' }],\n        password: [{ required: true, trigger: 'blur', message: '密码不能为空' }],\n        code: [{ required: true, trigger: 'change', message: '验证码不能为空' }]\n      },\n      loading: false,\n      redirect: undefined\n    }\n  },\n  watch: {\n    $route: {\n      handler: function(route) {\n        const data = route.query\n        if (data && data.redirect) {\n          this.redirect = data.redirect\n          delete data.redirect\n          if (JSON.stringify(data) !== '{}') {\n            this.redirect = this.redirect + '&' + qs.stringify(data, { indices: false })\n          }\n        }\n      },\n      immediate: true\n    }\n  },\n  created() {\n    // 获取验证码\n    this.getCode()\n    // 获取用户名密码等Cookie\n    this.getCookie()\n    // token 过期提示\n    this.point()\n  },\n  methods: {\n    getCode() {\n      getCodeImg().then(res => {\n        this.codeUrl = res.img\n        this.loginForm.uuid = res.uuid\n      })\n    },\n    getCookie() {\n      const username = Cookies.get('username')\n      let password = Cookies.get('password')\n      const rememberMe = Cookies.get('rememberMe')\n      // 保存cookie里面的加密后的密码\n      this.cookiePass = password === undefined ? '' : password\n      password = password === undefined ? this.loginForm.password : password\n      this.loginForm = {\n        username: username === undefined ? this.loginForm.username : username,\n        password: password,\n        rememberMe: rememberMe === undefined ? false : Boolean(rememberMe),\n        code: ''\n      }\n    },\n    handleLogin() {\n      this.$refs.loginForm.validate(valid => {\n        const user = {\n          username: this.loginForm.username,\n          password: this.loginForm.password,\n          rememberMe: this.loginForm.rememberMe,\n          code: this.loginForm.code,\n          uuid: this.loginForm.uuid\n        }\n        if (user.password !== this.cookiePass) {\n          user.password = encrypt(user.password)\n        }\n        if (valid) {\n          this.loading = true\n          if (user.rememberMe) {\n            Cookies.set('username', user.username, { expires: Config.passCookieExpires })\n            Cookies.set('password', user.password, { expires: Config.passCookieExpires })\n            Cookies.set('rememberMe', user.rememberMe, { expires: Config.passCookieExpires })\n          } else {\n            Cookies.remove('username')\n            Cookies.remove('password')\n            Cookies.remove('rememberMe')\n          }\n          this.$store.dispatch('Login', user).then(() => {\n            this.loading = false\n            this.$router.push({ path: this.redirect || '/' })\n          }).catch(() => {\n            this.loading = false\n            this.getCode()\n          })\n        } else {\n          console.log('error submit!!')\n          return false\n        }\n      })\n    },\n    point() {\n      const point = Cookies.get('point') !== undefined\n      if (point) {\n        this.$notify({\n          title: '提示',\n          message: '当前登录状态已过期，请重新登录！',\n          type: 'warning',\n          duration: 5000\n        })\n        Cookies.remove('point')\n      }\n    }\n  }\n}\n",null]}