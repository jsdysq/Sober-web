{"remainingRequest":"/Volumes/MAC1/javaproject/eladmin-web/node_modules/babel-loader/lib/index.js!/Volumes/MAC1/javaproject/eladmin-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Volumes/MAC1/javaproject/eladmin-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Volumes/MAC1/javaproject/eladmin-web/src/views/login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Volumes/MAC1/javaproject/eladmin-web/src/views/login.vue","mtime":1619011782546},{"path":"/Volumes/MAC1/javaproject/eladmin-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/MAC1/javaproject/eladmin-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Volumes/MAC1/javaproject/eladmin-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/MAC1/javaproject/eladmin-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Volumes/MAC1/javaproject/eladmin-web/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _rsaEncrypt = require(\"@/utils/rsaEncrypt\");\n\nvar _settings = _interopRequireDefault(require(\"@/settings\"));\n\nvar _login = require(\"@/api/login\");\n\nvar _jsCookie = _interopRequireDefault(require(\"js-cookie\"));\n\nvar _qs = _interopRequireDefault(require(\"qs\"));\n\nvar _background = _interopRequireDefault(require(\"@/assets/images/background.jpg\"));\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  name: 'Login',\n  data: function data() {\n    return {\n      Background: _background.default,\n      codeUrl: '',\n      cookiePass: '',\n      loginForm: {\n        username: 'admin',\n        password: '123456',\n        rememberMe: false,\n        code: '',\n        uuid: ''\n      },\n      loginRules: {\n        username: [{\n          required: true,\n          trigger: 'blur',\n          message: '用户名不能为空'\n        }],\n        password: [{\n          required: true,\n          trigger: 'blur',\n          message: '密码不能为空'\n        }],\n        code: [{\n          required: true,\n          trigger: 'change',\n          message: '验证码不能为空'\n        }]\n      },\n      loading: false,\n      redirect: undefined\n    };\n  },\n  watch: {\n    $route: {\n      handler: function handler(route) {\n        var data = route.query;\n\n        if (data && data.redirect) {\n          this.redirect = data.redirect;\n          delete data.redirect;\n\n          if (JSON.stringify(data) !== '{}') {\n            this.redirect = this.redirect + '&' + _qs.default.stringify(data, {\n              indices: false\n            });\n          }\n        }\n      },\n      immediate: true\n    }\n  },\n  created: function created() {\n    // 获取验证码\n    this.getCode(); // 获取用户名密码等Cookie\n\n    this.getCookie(); // token 过期提示\n\n    this.point();\n  },\n  methods: {\n    getCode: function getCode() {\n      var _this = this;\n\n      (0, _login.getCodeImg)().then(function (res) {\n        _this.codeUrl = res.img;\n        _this.loginForm.uuid = res.uuid;\n      });\n    },\n    getCookie: function getCookie() {\n      var username = _jsCookie.default.get('username');\n\n      var password = _jsCookie.default.get('password');\n\n      var rememberMe = _jsCookie.default.get('rememberMe'); // 保存cookie里面的加密后的密码\n\n\n      this.cookiePass = password === undefined ? '' : password;\n      password = password === undefined ? this.loginForm.password : password;\n      this.loginForm = {\n        username: username === undefined ? this.loginForm.username : username,\n        password: password,\n        rememberMe: rememberMe === undefined ? false : Boolean(rememberMe),\n        code: ''\n      };\n    },\n    handleLogin: function handleLogin() {\n      var _this2 = this;\n\n      this.$refs.loginForm.validate(function (valid) {\n        var user = {\n          username: _this2.loginForm.username,\n          password: _this2.loginForm.password,\n          rememberMe: _this2.loginForm.rememberMe,\n          code: _this2.loginForm.code,\n          uuid: _this2.loginForm.uuid\n        };\n\n        if (user.password !== _this2.cookiePass) {\n          user.password = (0, _rsaEncrypt.encrypt)(user.password);\n        }\n\n        if (valid) {\n          _this2.loading = true;\n\n          if (user.rememberMe) {\n            _jsCookie.default.set('username', user.username, {\n              expires: _settings.default.passCookieExpires\n            });\n\n            _jsCookie.default.set('password', user.password, {\n              expires: _settings.default.passCookieExpires\n            });\n\n            _jsCookie.default.set('rememberMe', user.rememberMe, {\n              expires: _settings.default.passCookieExpires\n            });\n          } else {\n            _jsCookie.default.remove('username');\n\n            _jsCookie.default.remove('password');\n\n            _jsCookie.default.remove('rememberMe');\n          }\n\n          _this2.$store.dispatch('Login', user).then(function () {\n            _this2.loading = false;\n\n            _this2.$router.push({\n              path: _this2.redirect || '/'\n            });\n          }).catch(function () {\n            _this2.loading = false;\n\n            _this2.getCode();\n          });\n        } else {\n          console.log('error submit!!');\n          return false;\n        }\n      });\n    },\n    point: function point() {\n      var point = _jsCookie.default.get('point') !== undefined;\n\n      if (point) {\n        this.$notify({\n          title: '提示',\n          message: '当前登录状态已过期，请重新登录！',\n          type: 'warning',\n          duration: 5000\n        });\n\n        _jsCookie.default.remove('point');\n      }\n    }\n  }\n};\nexports.default = _default;",null]}